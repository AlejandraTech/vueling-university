# üåü **Unidad 7: Conexi√≥n de Base de Datos**

Esta unidad aborda la instalaci√≥n y configuraci√≥n de **SQL Server** y **SQL Server Management Studio (SSMS)**, as√≠ como la creaci√≥n y gesti√≥n de bases de datos. Adem√°s, se explica c√≥mo conectar la base de datos a un proyecto en **Visual Studio** utilizando **Entity Framework Core (EF Core)**.

---

### üóÇÔ∏è **√çndice**

| Secci√≥n                                                    | Descripci√≥n                                                                                            |
| ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| üõ†Ô∏è **Instalaci√≥n SQL Server Management**                   | Instrucciones para instalar SQL Server y SQL Server Management Studio (SSMS).                          |
| ‚öôÔ∏è **1. Instalar SQL Server**                              | Pasos para descargar e instalar SQL Server Express y configurar la cadena de conexi√≥n.                 |
| ‚öôÔ∏è **2. Instalar SQL Server Management Studio (SSMS)**     | Gu√≠a para descargar, instalar y configurar SSMS.                                                       |
| üèóÔ∏è **Desarrollo de la Base de Datos en SQL Server**        | Proceso de creaci√≥n de base de datos y tablas en SQL Server Management Studio (SSMS).                  |
| üÜï **1. Creaci√≥n de una Nueva Base de Datos**              | Pasos para crear una nueva base de datos en SSMS.                                                      |
| üìä **2. Creaci√≥n de Tablas en la Base de Datos**           | Instrucciones detalladas para crear y configurar tablas dentro de una base de datos.                   |
| üîó **3. Relacionar Tablas**                                | Gu√≠a para establecer relaciones de claves for√°neas entre tablas en SQL Server.                         |
| üîå **Conexi√≥n de la Base de Datos en Visual Studio**       | Procedimiento para conectar la base de datos con un proyecto en Visual Studio.                         |
| üîß **1. Configuraci√≥n de la Conexi√≥n de la Base de Datos** | Configuraci√≥n de la conexi√≥n a la base de datos utilizando EF Core Power Tools en Visual Studio.       |
| üî® **2. Generar Entidades de la Base de Datos**            | Generaci√≥n de entidades basadas en las tablas de la base de datos mediante ingenier√≠a inversa.         |
| üîÑ **3. Generar el DbContext**                             | Procedimiento para generar el DbContext a partir de las tablas de la base de datos.                    |
| üì¶ **Instalaci√≥n de Paquetes NuGet**                       | Pasos para instalar y configurar los paquetes NuGet necesarios para trabajar con EF Core.              |
| üóÇÔ∏è **Estructura de Carpetas al Conectar la Base de Datos** | Organizaci√≥n de los proyectos y carpetas dentro de una soluci√≥n al integrar una base de datos.         |
| üìö **Referencias**                                         | Fuentes y documentaci√≥n adicional para profundizar en la instalaci√≥n y el uso de SQL Server y EF Core. |

## üõ†Ô∏è Instalaci√≥n SQL Server Management

Para comenzar a trabajar con bases de datos en SQL Server, es necesario instalar tanto **SQL Server** como **SQL Server Management Studio (SSMS)**. A continuaci√≥n se detallan los pasos para realizar la instalaci√≥n:

---

### ‚öôÔ∏è 1. **Instalar SQL Server**

1. **Acceder al sitio web de Microsoft**:

   - Dir√≠gete a la p√°gina oficial de descargas de SQL Server: [Descargas de SQL Server](https://www.microsoft.com/es-es/sql-server/sql-server-downloads).

> [!NOTE]  
> Aseg√∫rate de elegir la versi√≥n adecuada para tus necesidades, SQL Server Express es ideal para desarrollos y pruebas locales.

2. **Seleccionar SQL Server Express**:

   - Descarga la opci√≥n **SQL Server Express** (la versi√≥n gratuita) que es adecuada para la mayor√≠a de los desarrollos y pruebas.

3. **Ejecutar el instalador**:

   - Una vez descargado el archivo ejecutable, ejec√∫talo y selecciona la opci√≥n **B√°sica** para realizar una instalaci√≥n sencilla.

4. **Seleccionar el idioma y aceptar los t√©rminos de licencia**:

   - Elige el idioma de la instalaci√≥n y acepta los t√©rminos de licencia.

5. **Especificar la ubicaci√≥n de la instalaci√≥n**:

   - Indica la carpeta de destino donde se instalar√° SQL Server.

6. **Ejecutar la instalaci√≥n**:

   - Haz clic en **Instalar** para que el proceso de instalaci√≥n comience.

7. **Cadena de Conexi√≥n**:
   - Una vez finalizada la instalaci√≥n, puedes conectarte a SQL Server utilizando la siguiente cadena de conexi√≥n:
     ```
     Server=localhost\SQLEXPRESS;Database=master;Trusted_Connection=True;
     ```

---

### ‚öôÔ∏è 2. **Instalar SQL Server Management Studio (SSMS)**

1. **Acceder a la p√°gina de SSMS**:

   - Dir√≠gete a la p√°gina de descarga de **SQL Server Management Studio** (SSMS) en [Microsoft SSMS](https://docs.microsoft.com/es-es/sql/ssms/download-sql-server-management-studio-ssms).

2. **Descargar SSMS**:

   - Haz clic en el enlace de descarga para obtener el instalador de SSMS.

3. **Ejecutar el instalador**:

   - Una vez descargado, ejecuta el archivo `.exe` y sigue los pasos del instalador.

4. **Reiniciar el PC**:

   - Despu√©s de completar la instalaci√≥n, es recomendable reiniciar el equipo.

> [!TIP]  
> Reiniciar el equipo despu√©s de la instalaci√≥n de SSMS puede evitar problemas de configuraci√≥n.

5. **Ejecutar SSMS como administrador**:
   - Para comenzar a usar SSMS, abre el programa **como administrador** y conecta con la instancia de SQL Server previamente instalada.

## üèóÔ∏è Desarrollo de la Base de Datos en SQL Server

### üÜï 1. **Creaci√≥n de una Nueva Base de Datos**

1. **Abrir SQL Server Management Studio (SSMS)**:

   - Inicia SSMS y con√©ctate a la instancia de SQL Server usando la cadena de conexi√≥n previamente configurada.

2. **Acceder a la carpeta de Bases de Datos**:

   - En el panel de objetos, haz clic derecho sobre la carpeta **Databases** y selecciona **New Database...**.

3. **Configurar la Base de Datos**:

   - En la ventana emergente, ingresa el nombre de la base de datos en el campo **Database Name** y configura otras opciones si es necesario.

4. **Crear la Base de Datos**:
   - Haz clic en **OK** para crear y guardar la base de datos. La nueva base de datos aparecer√° en el panel de objetos.

---

### üìä 2. **Creaci√≥n de Tablas en la Base de Datos**

1. **Acceder a la Carpeta de Tablas**:

   - Navega a **Databases > [Nombre de tu base de datos] > Tables** en el panel de objetos de SSMS.

2. **Crear una Nueva Tabla**:

   - Haz clic derecho sobre **Tables** y selecciona **New > Table...**.

3. **Definir las Columnas de la Tabla**:

   - Ingresa el nombre de cada columna, selecciona el tipo de dato adecuado (por ejemplo, **int**, **varchar**, **decimal**), y decide si permites valores nulos.

4. **Configurar la Columna Autoincremental**:

   - Para una columna que ser√° clave primaria o identificador √∫nico, selecciona la columna y en las propiedades de la columna, cambia **Is Identity** a "Yes" para hacerla autoincremental.

5. **Definir la Clave Primaria**:

   - Haz clic derecho sobre la columna que ser√° la clave primaria y selecciona **Set Primary Key**.

6. **Guardar la Tabla**:

   - Haz clic en **Save All** y asigna un nombre a la tabla.

7. **Actualizar la Lista de Tablas**:
   - Haz clic derecho sobre **Tables** y selecciona **Refresh** para ver la nueva tabla en la lista.

---

### üîó 3. **Relacionar Tablas**

1. **Abrir el Dise√±ador de Tablas**:

   - Haz clic derecho sobre la tabla que contendr√° la clave for√°nea y selecciona **Design**.

2. **Configurar Relaciones de Clave For√°nea**:

   - En el dise√±ador de la tabla, haz clic derecho en el √°rea en blanco y selecciona **Relationships**.

3. **A√±adir una Relaci√≥n de Clave For√°nea**:

   - En la ventana de relaciones, haz clic en **Add** para agregar una nueva relaci√≥n.

4. **Configurar las Tablas y Columnas para la Relaci√≥n**:

   - Selecciona las tablas y columnas involucradas en la relaci√≥n:
     - **Primary key table**: La tabla que contiene la clave primaria.
     - **Foreign key table**: La tabla que tendr√° la clave for√°nea.

5. **Guardar los Cambios**:
   - Haz clic en **Save All** para guardar la relaci√≥n de clave for√°nea y las modificaciones realizadas.

> [!IMPORTANT]  
> Aseg√∫rate de que las claves for√°neas se configuren correctamente para evitar problemas de integridad referencial en la base de datos.

## üîå Conexi√≥n de la Base de Datos en Visual Studio

### üîß 1. **Configuraci√≥n de la Conexi√≥n de la Base de Datos**

1. **Instalar EF Core Power Tools**:

   - **Abrir Visual Studio**.
   - Ve a la barra superior y selecciona **Extensiones > Administrar extensiones**.
   - En la ventana de **Administrador de Extensiones**, selecciona la pesta√±a **Buscar**.
   - En la barra de b√∫squeda, escribe **EF Core Power Tools**.
   - Haz clic en **Descargar** junto a la opci√≥n **EF Core Power Tools**.
   - **Reinicia Visual Studio** para completar la instalaci√≥n.
   - Una vez instalado, puedes verificarlo en **Extensiones > Administrar extensiones > Instaladas**.

2. **Iniciar Ingenier√≠a Inversa**:

   - En el **Explorador de Soluciones**, haz clic derecho sobre el proyecto en el que deseas realizar la conexi√≥n y selecciona **EF Core Power Tools > Reverse Engineer**.

3. **Seleccionar la Conexi√≥n de la Base de Datos**:

   - En la ventana emergente, selecciona la conexi√≥n de la base de datos que deseas utilizar o agrega una nueva conexi√≥n.

4. **Configurar la Cadena de Conexi√≥n**:

   - Ingresa los detalles de la conexi√≥n, como el **servidor**, la **autenticaci√≥n** y el **nombre de la base de datos**.

5. **Probar la Conexi√≥n**:

   - Si lo deseas, haz clic en **Test Connection** para verificar que la conexi√≥n es exitosa.

6. **Confirmar la Conexi√≥n**:
   - Haz clic en **OK** para cerrar la ventana de configuraci√≥n de la conexi√≥n.

---

### üî® 2. **Generar Entidades de la Base de Datos**

1. Haz clic derecho en el proyecto `NombreProyecto.Infrastructure.Contracts`

2. Selecciona **EF Core Power Tools** > **Reverse Engineer**.

3. **Seleccionar Tablas para Generar las Entidades**:

   - Despu√©s de configurar la conexi√≥n, selecciona las tablas de la base de datos que deseas usar como entidades.

4. **Configurar la Ruta de las Entidades**:

   - Define una carpeta como **Entities** donde se guardar√°n las clases generadas.

5. **Generar las Entidades**:
   - Haz clic en **OK** para generar las entidades en el proyecto.

---

### üîÑ 3. **Generar el DbContext**

1. Haz clic derecho en el proyecto `NombreProyecto.Infrastructure.Impl`

2. Selecciona **EF Core Power Tools** > **Reverse Engineer**.

3. **Seleccionar las Tablas para Generar el DbContext**:

   - En el proyecto de Visual Studio, selecciona las tablas para generar el **DbContext**.

4. **Configurar la Ruta del DbContext**:

   - Define la ruta para almacenar el **DbContext**, como una carpeta llamada **DbContexts**.

5. **Generar el DbContext**:

   - Haz clic en **OK** para generar el **DbContext** en la ubicaci√≥n configurada.

6. **Verificar las Entidades y el DbContext**:
   - Aseg√∫rate de que las entidades y el **DbContext** se hayan generado correctamente en sus respectivas carpetas dentro del proyecto.

## üì¶ Instalaci√≥n de Paquetes NuGet

1. **Instalar los Paquetes Necesarios**:

   - En Visual Studio, abre el **Administrador de Paquetes NuGet** e instala los siguientes paquetes necesarios para trabajar con **Entity Framework Core**:
     - `Microsoft.EntityFrameworkCore.SqlServer`
     - `Microsoft.EntityFrameworkCore.Tools`

2. **Actualizar los Paquetes**:

   - Aseg√∫rate de que todos los paquetes est√©n actualizados a la versi√≥n correcta, especialmente si trabajas con versiones espec√≠ficas de **EF Core**.

3. **Verificar la Instalaci√≥n**:
   - Una vez instalados los paquetes, verifica que la conexi√≥n y la generaci√≥n de entidades y **DbContext** se hayan completado correctamente.

## üóÇÔ∏è Estructura de Carpetas al Conectar la Base de Datos

```plaintext
NombreProyecto
‚îÇ
‚îú‚îÄ‚îÄ DistributedServices
‚îÇ   ‚îî‚îÄ‚îÄ NombreProyecto.DistributedServices.WebAPIUI
‚îú‚îÄ‚îÄ Library
‚îÇ   ‚îú‚îÄ‚îÄ NombreProyecto.Library.Contracts
|   |   ‚îî‚îÄ‚îÄ DTOs
‚îÇ   ‚îî‚îÄ‚îÄ NombreProyecto.Library.Impl
‚îú‚îÄ‚îÄ Domain
‚îÇ   ‚îî‚îÄ‚îÄ NombreProyecto.Domain.Models
‚îú‚îÄ‚îÄ Infrastructure
‚îÇ   ‚îú‚îÄ‚îÄ NombreProyecto.Infrastructure.Contracts
|   |   ‚îî‚îÄ‚îÄ Entities
‚îÇ   ‚îî‚îÄ‚îÄ NombreProyecto.Infrastructure.Impl
|       ‚îî‚îÄ‚îÄ DbContexts
‚îî‚îÄ‚îÄ XCutting
    ‚îî‚îÄ‚îÄ NombreProyecto.XCutting.Enums
```

## üìö Referencias

[Descargas de SQL Server - Microsoft](https://www.microsoft.com/es-es/sql-server/sql-server-downloads)

[Descargar SSMS - Microsoft Docs](https://docs.microsoft.com/es-es/sql/ssms/download-sql-server-management-studio-ssms)

[Crear y administrar bases de datos - SQL Server](https://docs.microsoft.com/es-es/sql/ssms/overview/ssms?view=sql-server-ver15)

[Relaciones de clave for√°nea en SQL Server](https://docs.microsoft.com/es-es/sql/ssms/objects/foreign-keys?view=sql-server-ver15)

[Introducci√≥n a Entity Framework Core](https://learn.microsoft.com/es-es/ef/core/)

[EF Core Power Tools en GitHub](https://github.com/ErikEJ/EFCorePowerTools)

[Gu√≠a de instalaci√≥n y uso de EF Core](https://learn.microsoft.com/es-es/ef/core/get-started/overview/first-app)

[Conectar con bases de datos en Visual Studio](https://learn.microsoft.com/es-es/visualstudio/data-tools/sql-server-data-tools?view=vs-2022)

[Documentaci√≥n de NuGet para EF Core](https://learn.microsoft.com/es-es/nuget/consume-packages/overview-and-workflow)

[Migraciones con EF Core](https://learn.microsoft.com/es-es/ef/core/managing-schemas/migrations/)
